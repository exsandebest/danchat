<html>

<head>
  <meta charset="utf-8">

  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<title>Вход</title>
    <style>
        input {
            padding: 10px;
            font-size: 1em;
            border: 5px solid rgba(255, 255, 255, .5);
        @include box-shadow(
        0 2px 10px rgba(0, 0, 0, .25) inset,
        0 2px 10px rgba(0, 0, 0, .25));
        @include border-radius(5px);
            background: rgba(255, 255, 255, .5);
        @include appearance(none);
            outline: none;
            color: #333;
            width: 20%;
        }

    </style>
</head>

<body background="bg.jpg">
  <h1>Вход</h1>
<style>
</style>
<link rel="stylesheet" type="text/css" href="style.css">
  <center>
    <input class='pole' type="text" required name="login" autofocus id="login" title="Логин" placeholder="Введите логин"><br><br>
    <input class='pole' type="password" required name="password" id="password" title="Пароль" onkeypress="if(event.keyCode == 13) enter()" placeholder="Введите пароль"><br><br>
    <div id="notification"> 
    </div><br>
      <buttons class="buttons" type="button" onclick="enter()">Войти</buttons><br><br>
      <span class="purple">или</span><br><br>
      <a href="/registration" style="text-decoration: none;"><buttons class="buttons" type="button">Зарегистрироваться</buttons></a>
</center>
<script >
sessionStorage.clear();
function enter() {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/enter", true);
        xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
        xhr.onload = ()=>{
            if (xhr.responseText === "token"){
              location = "/";

            } else if (xhr.responseText.split(":")[0] === "false"){
                notif(xhr.responseText.split(":")[1]);
            } else  {
            notif("Проблемы с сервером<br>Приносим извинения");
            }
        }
        xhr.send(`login=${document.getElementById("login").value.replace(/\s/,"")}&password=${encrypt(document.getElementById("password").value.replace(/\s/,""))}`);
}

function notif (msg){
  document.getElementById("notification").setAttribute("style", "opacity:0");
    document.getElementById("notification").innerHTML = `<notificationBad>${msg}</notificationBad>`;
    document.getElementById("notification").setAttribute("style", "opacity:1");
    setTimeout(()=>{
      document.getElementById("notification").setAttribute("style", "opacity:0");
    }, 5000);

}

function encrypt(theText) {
  var output = "";
  var Temp = [];
  var Temp2 = [];
  var TextSize = theText.length;
  for (var i = 0; i < TextSize; i++) {
    var rnd = Math.round(Math.random() * 217) + 68;
    Temp[i] = theText.charCodeAt(i) + rnd;
    Temp2[i] = rnd;
  }
  for (i = 0; i < TextSize; i++) {
    output += String.fromCharCode(Temp[i], Temp2[i]);
  }
  return output;
}


</script>
{{> footer}}
</body>
</html>
